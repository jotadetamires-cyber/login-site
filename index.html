<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro de Fornecimentos</title>
<style>
    body { font-family: Arial; margin: 20px; background-color: #f4f4f4; display: flex; justify-content: center; }
    .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); width: 950px; }
    h1, h2 { text-align: center; color: #333; }
    form { margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px 20px; }
    form div { display: flex; flex-direction: column; }
    label { margin-bottom: 3px; font-weight: bold; font-size: 14px; }
    input, select { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
    .full-width { grid-column: 1 / 3; }
    button { background-color: #28a745; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 15px; grid-column: 1 / 3; justify-self: center; }
    button:hover { background-color: #218838; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; text-align: left; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align:center; }
    th { background-color: #f2f2f2; }
    tbody tr:nth-child(odd) { background-color: #f9f9f9; }
    select.statusSelect { width: 100%; border: none; background-color: transparent; font-weight: bold; text-align:center; }
    button.deleteBtn { background-color: #dc3545; color: white; padding: 4px 8px; border-radius: 4px; border: none; cursor: pointer; }
    button.deleteBtn:hover { background-color: #c82333; }
</style>
</head>
<body>

<div class="container">
    <h1>Fornecimentos Muipeliua</h1>
    <form id="cadastroForm">
        <div><label>Nome da Empresa:</label><input type="text" id="empresa" required></div>
        <div><label>Fornecedor:</label><input type="text" id="fornecedor" required></div>
        <div><label>Material Fornecido:</label><input type="text" id="material" required></div>
        <div><label>Quantidade:</label><input type="number" id="quantidade" required></div>
        <div><label>Preço Unitário (R$):</label><input type="number" id="preco" step="0.01" required></div>
        <div><label>Status:</label>
            <select id="status" required>
                <option value="">Selecione</option>
                <option value="Pago">Pago</option>
                <option value="Não Pago">Não Pago</option>
            </select>
        </div>
        <button type="submit" class="full-width">Cadastrar</button>
    </form>

    <h2>Fornecimentos Cadastrados</h2>
    <table id="tabelaFornecimentos">
        <thead>
            <tr>
                <th>Empresa</th><th>Fornecedor</th><th>Material</th><th>Quantidade</th>
                <th>Preço Unitário</th><th>Preço Total</th><th>Data</th><th>Status</th><th>Ações</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
// ---------- FUNÇÕES BÁSICAS ----------
function atualizarCorStatus(select){
    if(select.value === "Pago"){ select.style.color = "green"; }
    else if(select.value === "Não Pago"){ select.style.color = "red"; }
    else { select.style.color = "black"; }
}

function criarCelulaEditavel(text, tipo="text"){
    const input = document.createElement("input");
    input.value = text;
    input.type = tipo;
    input.style.textAlign = "center";
    return input;
}

// ---------- SALVAR LOCAL E GOOGLE SHEET ----------
function salvarLocal(){
    const linhas = [];
    document.querySelectorAll("#tabelaFornecimentos tbody tr").forEach(linha=>{
        const cells = linha.querySelectorAll("td");
        linhas.push({
            empresa: cells[0].firstChild.value,
            fornecedor: cells[1].firstChild.value,
            material: cells[2].firstChild.value,
            quantidade: cells[3].firstChild.value,
            preco: cells[4].firstChild.value,
            data: cells[6].innerText,
            status: cells[7].firstChild.value
        });
    });
    localStorage.setItem("fornecimentos", JSON.stringify(linhas));
}

function enviarParaGoogleSheet(dado){
    fetch("https://script.google.com/macros/s/AKfycbyAyeW60AA4CfI7TKP66tsf1TwOEV8mWmeRLT7uPZItvJpsClZWruaZdjhX_hoXqf-c/exec", {
        method: "POST",
        body: JSON.stringify(dado),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(res => { if(res.result === "success") console.log("Dados enviados!"); })
    .catch(err => console.error("Erro de rede:", err));
}

function carregarDados(){
    const dados = JSON.parse(localStorage.getItem("fornecimentos") || "[]");
    dados.forEach(item=> adicionarLinha(item));
}

// ---------- ADICIONAR LINHA ----------
function adicionarLinha(dado){
    const tabela = document.getElementById('tabelaFornecimentos').querySelector('tbody');
    const novaLinha = tabela.insertRow();

    const celulaEmpresa = novaLinha.insertCell(0); celulaEmpresa.appendChild(criarCelulaEditavel(dado.empresa));
    const celulaFornecedor = novaLinha.insertCell(1); celulaFornecedor.appendChild(criarCelulaEditavel(dado.fornecedor));
    const celulaMaterial = novaLinha.insertCell(2); celulaMaterial.appendChild(criarCelulaEditavel(dado.material));
    const celulaQuantidade = novaLinha.insertCell(3); celulaQuantidade.appendChild(criarCelulaEditavel(dado.quantidade, "number"));
    const celulaPreco = novaLinha.insertCell(4); celulaPreco.appendChild(criarCelulaEditavel(dado.preco, "number"));
    const celulaTotal = novaLinha.insertCell(5); celulaTotal.innerText = `R$ ${(dado.quantidade * dado.preco).toFixed(2)}`;
    const celulaData = novaLinha.insertCell(6); celulaData.innerText = dado.data;

    // Status
    const statusCell = novaLinha.insertCell(7);
    const selectStatus = document.createElement('select');
    selectStatus.className = 'statusSelect';
    ['Pago','Não Pago'].forEach(op=>{
        const option = document.createElement('option');
        option.value = op; option.text = op;
        if(op === dado.status) option.selected = true;
        selectStatus.appendChild(option);
    });
    atualizarCorStatus(selectStatus);
    statusCell.appendChild(selectStatus);

    // Botão eliminar
    const acaoCell = novaLinha.insertCell(8);
    const botaoExcluir = document.createElement('button');
    botaoExcluir.innerText = "Eliminar"; botaoExcluir.className = "deleteBtn";
    botaoExcluir.disabled = selectStatus.value !== "Pago";
    botaoExcluir.addEventListener('click', ()=>{
        novaLinha.remove();
        salvarLocal();
    });
    acaoCell.appendChild(botaoExcluir);

    // Atualizações dinâmicas
    function atualizarTudo(){
        atualizarCorStatus(selectStatus);
        botaoExcluir.disabled = selectStatus.value !== "Pago";
        const qtd = parseFloat(celulaQuantidade.firstChild.value) || 0;
        const precoUni = parseFloat(celulaPreco.firstChild.value) || 0;
        celulaTotal.innerText = `R$ ${(qtd*precoUni).toFixed(2)}`;
        salvarLocal();
    }
    [selectStatus, celulaQuantidade.firstChild, celulaPreco.firstChild].forEach(el=>{
        el.addEventListener('input', atualizarTudo);
        el.addEventListener('change', atualizarTudo);
    });
}

// ---------- FORMULÁRIO ----------
document.getElementById('cadastroForm').addEventListener('submit', function(event){
    event.preventDefault();

    const empresa = document.getElementById('empresa').value;
    const fornecedor = document.getElementById('fornecedor').value;
    const material = document.getElementById('material').value;
    const quantidade = parseFloat(document.getElementById('quantidade').value);
    const preco = parseFloat(document.getElementById('preco').value);
    const status = document.getElementById('status').value;
    const data = new Date().toLocaleDateString('pt-BR');

    const dado = {empresa, fornecedor, material, quantidade, preco, status, data};
    adicionarLinha(dado);
    salvarLocal();
    enviarParaGoogleSheet(dado);

    document.getElementById('cadastroForm').reset();
});

// ---------- INICIAR ----------
window.addEventListener("load", carregarDados);
</script>

</body>
</html>

