<label for="produto">Produto:</label>
<input id="produto" type="text" name="produto" list="lista-produtos" required autocomplete="off">
<datalist id="lista-produtos"></datalist>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycby3RPB8EPhHMjuaanVowNmtHoft4ekrtENPnZmvAB7D00LqVsOf3z75C7eB8ApiVYC7/exec";
const form = document.getElementById('form');
const msg = document.getElementById('msg');
const btn = form.querySelector('button');
const lista = document.getElementById('lista-produtos');

// Buscar lista de produtos existentes ao carregar
window.addEventListener('DOMContentLoaded', async () => {
  try {
    const res = await fetch(scriptURL); // GET
    const dados = await res.json();
    lista.innerHTML = dados.produtos.map(p => `<option value="${p}">`).join('');
  } catch (err) {
    console.error('Erro ao carregar produtos existentes', err);
  }
});

form.addEventListener('submit', async e => {
  e.preventDefault();

  const formData = new FormData(form);
  const data = Object.fromEntries(formData);

  if (data.quantidade <= 0 || data.pcompra <= 0 || data.pvenda <= 0) {
    msg.innerText = "❌ Valores inválidos!";
    msg.style.color = "red";
    setTimeout(() => msg.innerText = '', 3000);
    return;
  }

  btn.disabled = true;

  try {
    const res = await fetch(scriptURL, {
      method: 'POST',
      body: JSON.stringify(data)
    });

    await res.json();

    msg.innerText = "✅ Produto cadastrado com sucesso!";
    msg.style.color = "green";
    form.reset();

  } catch(err) {
    msg.innerText = "❌ Erro ao salvar!";
    msg.style.color = "red";
    console.error(err);
  } finally {
    btn.disabled = false;
    setTimeout(() => msg.innerText = '', 3000);
  }
});
</script>
